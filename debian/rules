#!/usr/bin/make -f

%:
	dh $@ --with python3

override_dh_auto_install:
	# Устанавливаем файлы приложения
	mkdir -p $(CURDIR)/debian/xgamma-gui-tool/usr/bin
	mkdir -p $(CURDIR)/debian/xgamma-gui-tool/usr/share/xgamma-gui-tool
	mkdir -p $(CURDIR)/debian/xgamma-gui-tool/usr/share/applications
	
	# Копируем исходные файлы
	cp -r $(CURDIR)/src $(CURDIR)/debian/xgamma-gui-tool/usr/share/xgamma-gui-tool/
	cp $(CURDIR)/main.py $(CURDIR)/debian/xgamma-gui-tool/usr/share/xgamma-gui-tool/
	cp $(CURDIR)/requirements.txt $(CURDIR)/debian/xgamma-gui-tool/usr/share/xgamma-gui-tool/
	
	# Создаем исполняемый скрипт
	echo '#!/usr/bin/env python3' > $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	echo 'import sys' >> $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	echo 'sys.path.insert(0, "/usr/share/xgamma-gui-tool")' >> $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	echo 'from src.main import main' >> $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	echo 'if __name__ == "__main__":' >> $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	echo '    main()' >> $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	chmod +x $(CURDIR)/debian/xgamma-gui-tool/usr/bin/xgamma-gui-tool
	
	# Копируем desktop файл
	if [ -f $(CURDIR)/debian/xgamma-gui-tool.desktop ]; then \
		cp $(CURDIR)/debian/xgamma-gui-tool.desktop $(CURDIR)/debian/xgamma-gui-tool/usr/share/applications/; \
	fi